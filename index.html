<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self'; script-src 'self' 'unsafe-inline' https://challenges.cloudflare.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: https://*.supabase.co; font-src 'self' data: https://fonts.gstatic.com; connect-src 'self' https://*.supabase.co https://api.fontshare.com https://challenges.cloudflare.com; frame-src 'self' https://cybermap.kaspersky.com https://challenges.cloudflare.com;" />
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <title>Kushal Kumawat | Cybersecurity Student & Developer</title>
  <meta name="description"
    content="Portfolio of Kushal Kumawat - Cybersecurity Student, Web Developer, and Python Automation Expert. Intern at Inlighn Tech & CodTech." />
  <meta name="author" content="Kushal Kumawat" />

  <meta property="og:title" content="Kushal Kumawat | Cybersecurity Student & Developer" />
  <meta property="og:description"
    content="Portfolio showcasing cybersecurity projects, web development, and automation solutions by Kushal Kumawat" />

  <!-- Cloudflare Turnstile -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</head>

<body style="margin: 0; overflow: hidden;">
  <!-- Full-Screen Security Verification Overlay -->
  <div id="security-overlay" style="
    position: fixed;
    inset: 0;
    background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
    z-index: 999999;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    font-family: system-ui, -apple-system, sans-serif;
    cursor: default;
  ">
    <div style="
      text-align: center;
      padding: 40px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(6, 182, 212, 0.3);
      box-shadow: 0 0 40px rgba(6, 182, 212, 0.2);
      max-width: 500px;
    ">
      <h2 style="
        color: #06b6d4;
        margin: 0 0 12px 0;
        font-size: 28px;
        font-weight: 700;
        text-shadow: 0 0 20px rgba(6, 182, 212, 0.5);
      ">Security Verification</h2>
      <p style="
        color: rgba(255, 255, 255, 0.7);
        margin: 0 0 24px 0;
        font-size: 14px;
      ">Please verify you're human to continue</p>
      <div id="turnstile-widget"></div>
      <div id="verification-status" style="
        margin-top: 16px;
        color: rgba(255, 255, 255, 0.6);
        font-size: 13px;
        min-height: 20px;
      "></div>
    </div>
  </div>

  <!-- Main Website Content (Hidden until verified) -->
  <div id="main-site" style="display: none;">
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </div>

  <!-- Turnstile Verification Script -->
  <script>
    // Configuration
    const TURNSTILE_SITE_KEY = "0x4AAAAAAACCnPOSXXplvy65O"; // Turnstile site key
    const VERIFY_ENDPOINT = "/api/verifyTurnstile";

    // State
    let isVerifying = false;

    // Update status message
    function updateStatus(message, isError = false) {
      const statusEl = document.getElementById("verification-status");
      if (statusEl) {
        statusEl.textContent = message;
        statusEl.style.color = isError ? "#ef4444" : "rgba(255, 255, 255, 0.6)";
      }
    }

    // Verify token with backend
    async function verifyToken(token) {
      if (isVerifying) return;
      isVerifying = true;

      updateStatus("Verifying...");

      try {
        const response = await fetch(VERIFY_ENDPOINT, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ token }),
        });

        const result = await response.json();

        if (result.success) {
          updateStatus("Verification successful!");
          unlockWebsite();
        } else {
          updateStatus("Verification failed. Please try again.", true);
          setTimeout(() => {
            alert("CAPTCHA verification failed. The page will reload.");
            window.location.reload();
          }, 1500);
        }
      } catch (error) {
        console.error("Verification error:", error);
        updateStatus("Network error. Please check your connection.", true);
        setTimeout(() => {
          alert("Unable to verify CAPTCHA. The page will reload.");
          window.location.reload();
        }, 2000);
      } finally {
        isVerifying = false;
      }
    }

    // Unlock website after successful verification
    function unlockWebsite() {
      const overlay = document.getElementById("security-overlay");
      const mainSite = document.getElementById("main-site");

      if (overlay && mainSite) {
        // Fade out overlay
        overlay.style.transition = "opacity 0.4s ease";
        overlay.style.opacity = "0";

        setTimeout(() => {
          overlay.style.display = "none";
          mainSite.style.display = "block";
          document.body.style.overflow = "auto"; // Re-enable scroll
        }, 400);
      }
    }

    // Initialize Turnstile when ready
    document.addEventListener("DOMContentLoaded", function () {
      if (window.turnstile) {
        window.turnstile.ready(function () {
          try {
            turnstile.render("#turnstile-widget", {
              sitekey: TURNSTILE_SITE_KEY,
              callback: function (token) {
                verifyToken(token);
              },
              "error-callback": function () {
                updateStatus("CAPTCHA error. Please reload the page.", true);
                setTimeout(() => {
                  alert("CAPTCHA failed to load. The page will reload.");
                  window.location.reload();
                }, 2000);
              },
              "expired-callback": function () {
                updateStatus("CAPTCHA expired. Please try again.", true);
                setTimeout(() => {
                  window.location.reload();
                }, 1500);
              },
            });
          } catch (error) {
            console.error("Turnstile render error:", error);
            updateStatus("Failed to load CAPTCHA. Please reload.", true);
          }
        });
      } else {
        updateStatus("CAPTCHA script not loaded. Please reload.", true);
      }
    });
  </script>
</body>